name: Update Daily Game Key

on:
  schedule:
    - cron: "0 0 * * *"  # Má»—i ngÃ y 0h UTC (7h sÃ¡ng VN)
  workflow_dispatch:

jobs:
  update-key:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Gá»i SheetDB vÃ  táº¡o key.json
      run: |
        curl -s https://sheetdb.io/api/v1/tvmy9ezg0xkh9 > keys.json
        START_DATE="2025-07-01"
        TODAY=$(date +%F)
        DAYS=$(( ($(date -d "$TODAY" +%s) - $(date -d "$START_DATE" +%s)) / 86400 ))
        KEY=$(jq -r ".[$DAYS].abc123xyz" keys.json)

        if [[ -z "$KEY" || "$KEY" == "null" ]]; then
          echo "KhÃ´ng tÃ¬m tháº¥y key táº¡i vá»‹ trÃ­ $DAYS"
          exit 1
        fi

        echo "{ \"date\": \"$TODAY\", \"key\": \"$KEY\" }" > key.json

    - name: Commit and push
      run: |
        git config user.name "KeyBot"
        git config user.email "keybot@github.com"
        git add key.json
        git commit -m "ðŸ”„ Cáº­p nháº­t key ngÃ y $(date +%F)"
        git push
