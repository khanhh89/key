    <!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lấy Key Game Hàng Ngày</title>
    <style>
        /* Biến CSS cho màu sắc dễ quản lý */
        :root {
            --primary-color: #4CAF50; /* Xanh lá cây nổi bật */
            --secondary-color: #6a1b9a; /* Tím */
            --text-color: #e0e0e0; /* Trắng xám cho chữ */
            --background-dark: #2c2c2c; /* Nền tối */
            --background-light: #3a3a3a; /* Nền sáng hơn một chút */
            --border-color: #555;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }

        /* Khung xương cơ bản */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-dark);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Đảm bảo trang chiếm toàn bộ chiều cao màn hình */
            overflow: hidden; /* Ngăn cuộn khi có bg-animation */
            position: relative;
        }

        /* Hiệu ứng nền */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Đảm bảo nằm dưới nội dung */
            background: radial-gradient(circle at top left, var(--secondary-color) 0%, transparent 40%),
                        radial-gradient(circle at bottom right, var(--primary-color) 0%, transparent 40%);
            animation: fadeIn 2s ease-out forwards; /* Hiệu ứng mờ dần khi tải trang */
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Container chính */
        .container {
            background-color: var(--background-light);
            padding: 3rem 2.5rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow-color);
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            z-index: 1; /* Đảm bảo nằm trên nền */
            animation: slideInUp 0.8s ease-out forwards; /* Hiệu ứng trượt lên */
            transform: translateY(20px);
            opacity: 0;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 2.2rem;
            font-weight: 600;
        }

        .key-date {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #b0b0b0;
        }

        .key-container {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--background-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem 1.2rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            flex-wrap: wrap; /* Đảm bảo key và nút không tràn ra ngoài trên mobile */
            gap: 10px; /* Khoảng cách giữa key và nút */
        }

        #keyText {
            flex-grow: 1; /* Cho phép text chiếm nhiều không gian hơn */
            font-size: 1.6rem;
            font-weight: 600;
            color: #fff;
            word-break: break-all; /* Ngắt từ nếu key quá dài */
            text-align: left; /* Căn trái văn bản key */
            padding-right: 10px;
        }

        .envelope {
            cursor: pointer;
            font-size: 1.8rem;
            color: var(--primary-color);
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s ease-in-out;
            display: flex; /* Dùng flex để căn giữa icon */
            justify-content: center;
            align-items: center;
            width: 40px; /* Kích thước cố định cho nút */
            height: 40px; /* Kích thước cố định cho nút */
            box-sizing: border-box;
            background-color: var(--background-dark); /* Nền nút */
            border: 1px solid var(--border-color);
        }

        .envelope:hover {
            color: #fff;
            background-color: var(--primary-color);
            box-shadow: 0 0 15px var(--primary-color);
            transform: scale(1.05);
        }

        .envelope:active {
            transform: scale(0.95);
        }

        /* Thông báo "Đã copy key!" */
        #copiedMsg {
            background-color: var(--primary-color);
            color: #fff;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            position: absolute;
            bottom: -30px; /* Đặt dưới container một chút */
            left: 50%;
            transform: translate(-50%, 0);
            white-space: nowrap;
            display: none; /* Ban đầu ẩn */
            opacity: 0;
            animation: fadeAndSlideUp 2s forwards; /* Kết hợp hiệu ứng */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-weight: 500;
        }

        /* Keyframes cho thông báo copy */
        @keyframes fadeAndSlideUp {
            0% {
                opacity: 0;
                transform: translate(-50%, 10px);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -10px);
            }
        }

        /* Responsive cho màn hình nhỏ hơn */
        @media (max-width: 600px) {
            .container {
                padding: 2rem 1.5rem;
                border-radius: 10px;
            }

            h1 {
                font-size: 1.8rem;
                margin-bottom: 1rem;
            }

            .key-date {
                font-size: 1rem;
            }

            #keyText {
                font-size: 1.2rem;
            }

            .envelope {
                font-size: 1.5rem;
                width: 35px;
                height: 35px;
            }

            .key-container {
                padding: 0.8rem 1rem;
                margin-top: 1rem;
                margin-bottom: 1rem;
            }

            #copiedMsg {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
                bottom: -20px;
            }
        }
    </style>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="bg-animation"></div>
  <div class="container">
    <h1>Lấy Key Game Hàng Ngày</h1>
    <div class="key-date" id="keyDate">Đang tải...</div>
    <div class="key-container">
      <span id="keyText">Đang tải...</span>
      <span class="envelope" onclick="copyKey()">✉️</span>
    </div>
    <div id="copiedMsg">Đã copy key!</div>
  </div>

  <script>
    // *******************************************************************
    // ĐÂY LÀ URL ĐẾN GOOGLE APPS SCRIPT WEB APP CỦA BẠN
    // Đảm bảo URL này là chính xác từ triển khai Web App của bạn
    // (Từ "Deploy" -> "Manage deployments" -> Sao chép URL Web App)
    const GOOGLE_SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyu54ooCKK9mM8T-2E-HVk5bTPX8H-OAOAtnjpAu8gTPebV4k7cqT1GjQFdI5Lesz4W/exec";
    // *******************************************************************

    // Hàm để lấy chuỗi ngày hiện tại định dạng ISO (YYYY-MM-DD)
    // Điều này giúp so sánh ngày chính xác
    function getTodayStringISO() {
      const today = new Date();
      return today.toISOString().split('T')[0]; // Ví dụ: "2025-07-09"
    }

    // Hàm chính để lấy key hàng ngày từ Google Apps Script
    async function getDailyKeyFromScript() {
      try {
        // Thêm một tham số ngẫu nhiên vào URL để tránh cache của trình duyệt
        const urlWithCacheBuster = `${GOOGLE_SCRIPT_WEB_APP_URL}?_t=${new Date().getTime()}`;
        
        // Thực hiện yêu cầu fetch đến Google Apps Script
        const response = await fetch(urlWithCacheBuster);

        // Kiểm tra xem phản hồi HTTP có thành công không (mã 2xx)
        if (!response.ok) {
          console.error('Lỗi HTTP khi tải dữ liệu từ Google Script:', response.status, response.statusText);
          return 'Không tải được key (Lỗi máy chủ)'; 
        }

        // Phân tích cú pháp phản hồi thành đối tượng JSON
        const data = await response.json(); 
        const todayISO = getTodayStringISO(); // Lấy ngày hôm nay định dạng ISO

        // --- Bắt đầu xử lý cấu trúc JSON mới ---
        if (data && Array.isArray(data.keys) && data.keys.length > 0) {
            // Duyệt qua mảng 'keys' để tìm key phù hợp với ngày hôm nay hoặc key không có ngày hết hạn
            for (const item of data.keys) {
                // Kiểm tra nếu có key và có expiry date
                if (item.key) {
                    if (item.expiry) {
                        const expiryDateISO = new Date(item.expiry).toISOString().split('T')[0];
                        // Nếu ngày hết hạn lớn hơn hoặc bằng ngày hôm nay, và key hợp lệ
                        if (expiryDateISO >= todayISO) {
                            return item.key; // Trả về key đầu tiên tìm thấy còn hạn
                        }
                    } else {
                        // Nếu không có expiry date, coi là key hợp lệ luôn (hoặc bạn có thể thay đổi logic này)
                        return item.key; // Trả về key đầu tiên không có ngày hết hạn
                    }
                }
            }
            // Nếu duyệt hết mà không tìm thấy key còn hạn hoặc key không có expiry date
            return 'Key hôm nay đã hết hạn hoặc chưa có';
        } else {
          // Trường hợp: JSON không có mảng 'keys', hoặc mảng rỗng, hoặc cấu trúc không đúng
          console.warn('JSON từ script không chứa mảng key hợp lệ hoặc cấu trúc không đúng:', data);
          return 'Key hôm nay chưa được cập nhật'; 
        }
      } catch (err) {
        // Xử lý lỗi trong quá trình fetch hoặc phân tích cú pháp JSON
        console.error('❌ Lỗi đọc hoặc phân tích cú pháp JSON từ Google Script:', err);
        return 'Không tải được key'; 
      }
    }

    // Hàm cập nhật hiển thị key và ngày lên giao diện
    function updateKeyDisplay() {
      // Hiển thị ngày hiện tại bằng ngôn ngữ địa phương (ví dụ: "9/7/2025")
      document.getElementById('keyDate').textContent = `Key ngày: ${new Date().toLocaleDateString('vi-VN')}`;

      // Gọi hàm lấy key và cập nhật nội dung
      getDailyKeyFromScript().then(key => {
        document.getElementById('keyText').textContent = key;
      });
    }

    // Hàm sao chép key vào clipboard
    function copyKey() {
      const key = document.getElementById('keyText').textContent.trim();
      // Ngăn không cho copy các thông báo lỗi hoặc trạng thái
      if (key === 'Đang tải...' || key.includes('Không tải được key') || key.includes('Key hôm nay chưa được cập nhật') || key.includes('Key hôm nay đã hết hạn')) {
        alert('Key chưa sẵn sàng hoặc không hợp lệ để sao chép!');
        return;
      }

      // Sử dụng Clipboard API hiện đại
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(key)
          .then(showCopiedMsg) // Hiển thị thông báo đã copy nếu thành công
          .catch(() => fallbackCopy(key)); // Dùng cách cũ nếu có lỗi
      } else {
        fallbackCopy(key); // Dùng cách cũ nếu API không được hỗ trợ
      }
    }

    // Hàm sao chép dự phòng cho các trình duyệt cũ hơn
    function fallbackCopy(text) {
      const tempInput = document.createElement('textarea');
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      try {
        document.execCommand('copy');
        showCopiedMsg();
      } catch (err) {
        alert('Không thể sao chép key!');
      }
      document.body.removeChild(tempInput);
    }

    // Hàm hiển thị thông báo "Đã copy key!"
    function showCopiedMsg() {
      const msg = document.getElementById('copiedMsg');
      msg.style.display = 'block';
      setTimeout(() => msg.style.display = 'none', 2000); // Tự động ẩn sau 2 giây
    }

    // Gọi hàm này khi trang HTML được tải hoàn tất
    updateKeyDisplay();
  </script>
</body>
</html>
